/**
 * What if I just put everything into one big file this year
 */

let html = (tag, props, ...children) => {
    let node = document.createElement(tag);
    if (props)
        for (let key in props)
            node.setAttribute(key, props[key]);
    for (let child of children)
        node.appendChild(child);
    return node;
};

let text = t => document.createTextNode(t);

////////////////////////
//        Font        //
////////////////////////
// Stolen from https://github.com/LeoRiether/Fireworks2019.5JS/blob/master/font.js
let Font = (() => {
    const min = (a, b) => a < b ? a : b;
    const max = (a, b) => a > b ? a : b;
    const minvec = (a, b) => [ min(a[0], b[0]), min(a[1], b[1]) ];
    const maxvec = (a, b) => [ max(a[0], b[0]), max(a[1], b[1]) ];

    // Lets you record a sequence of points when dragging/clicking on the screen
    let recording = {
        points: [],
        mouseDown: false,
        updatedAt: 0,
        throttle: 0,

        setup() {
            window.addEventListener('mousedown', this.onmousedown.bind(this));
            window.addEventListener('mouseup', this.onmouseup.bind(this));
            window.addEventListener('mousemove', this.onmousemove.bind(this));
        },

        reset() {
            this.points = [];
        },

        onmousedown() { this.mouseDown = true; },
        onmouseup() { this.mouseDown = false; },
        onmousemove(e) {
            if (this.mouseDown) {
                let lastUpdate = this.updatedAt;
                this.updatedAt = performance.now();
                let delta = this.updatedAt - lastUpdate;

                if (delta < this.throttle) {
                    return;
                }

                this.points.push([ e.clientX, e.clientY ]);
            }
        },

        output() {
            console.log(JSON.stringify(this.points));
        }
    };

    // Pre-recorded glyphs for every number of the base 10 system
    let glyphs = [
        [[454,207],[453,207],[452,207],[452,207],[451,207],[450,207],[449,207],[448,207],[448,207],[447,207],[446,207],[445,207],[444,207],[443,207],[441,207],[441,208],[440,208],[440,208],[439,209],[437,209],[436,209],[436,209],[435,209],[434,209],[433,210],[432,210],[430,210],[429,210],[427,211],[426,212],[424,212],[423,213],[422,213],[420,213],[419,214],[416,214],[416,215],[415,215],[413,215],[412,216],[411,216],[410,217],[409,218],[407,218],[406,218],[405,218],[404,220],[403,221],[401,222],[400,222],[399,222],[398,223],[397,223],[396,224],[394,225],[393,226],[392,227],[392,227],[390,227],[389,228],[388,228],[387,230],[385,231],[383,232],[382,232],[381,234],[380,234],[380,234],[378,235],[377,237],[376,238],[375,238],[375,239],[372,239],[372,241],[370,242],[369,243],[368,244],[367,246],[366,246],[365,247],[364,248],[363,249],[362,250],[362,250],[360,251],[360,252],[359,254],[358,254],[356,255],[356,257],[354,258],[354,258],[352,259],[351,261],[351,262],[349,263],[348,263],[348,265],[347,266],[345,268],[344,268],[344,269],[344,270],[344,271],[343,273],[341,274],[340,274],[340,276],[340,278],[339,278],[339,280],[337,281],[336,282],[336,283],[336,285],[335,286],[334,286],[333,289],[333,290],[333,292],[332,293],[332,294],[330,295],[328,299],[328,302],[327,303],[327,306],[326,307],[325,308],[324,311],[324,312],[323,314],[323,317],[322,318],[321,320],[321,322],[320,325],[320,326],[318,328],[318,330],[317,332],[316,335],[316,336],[316,338],[316,340],[316,342],[315,344],[315,346],[314,349],[314,350],[314,352],[314,355],[314,357],[314,358],[313,361],[313,365],[313,367],[312,369],[312,370],[312,373],[312,374],[312,377],[312,379],[312,382],[312,385],[312,386],[312,391],[312,393],[312,394],[313,398],[313,398],[314,401],[314,402],[316,406],[316,407],[316,409],[317,411],[317,414],[319,414],[320,417],[320,420],[320,422],[322,423],[323,426],[324,427],[325,431],[326,434],[327,436],[328,438],[330,440],[332,442],[333,444],[334,446],[336,449],[337,450],[339,454],[340,454],[341,458],[343,458],[344,461],[345,463],[346,466],[348,467],[349,469],[351,472],[352,474],[353,476],[354,478],[356,479],[356,481],[358,482],[360,485],[360,486],[362,486],[364,488],[365,490],[366,491],[367,492],[369,494],[370,495],[372,497],[372,498],[374,498],[376,499],[378,500],[378,501],[380,502],[382,502],[382,503],[384,504],[385,506],[386,506],[388,506],[389,506],[390,507],[391,509],[393,509],[395,510],[396,510],[397,510],[399,511],[400,511],[401,511],[403,512],[404,512],[406,513],[408,514],[409,514],[411,514],[413,515],[415,515],[416,516],[418,516],[420,516],[421,517],[424,517],[427,517],[428,517],[430,518],[433,518],[435,518],[437,518],[440,518],[441,518],[444,518],[447,518],[449,518],[451,518],[453,518],[456,518],[458,518],[460,518],[464,518],[466,518],[468,518],[472,518],[474,518],[476,518],[481,518],[484,518],[486,518],[489,518],[492,518],[494,518],[496,518],[500,518],[502,518],[504,517],[506,517],[508,516],[512,516],[513,515],[516,514],[525,512],[526,512],[530,510],[532,510],[535,509],[537,507],[540,506],[540,505],[544,504],[547,502],[548,502],[551,500],[552,500],[554,498],[559,497],[560,495],[562,494],[564,494],[567,492],[568,492],[568,491],[571,490],[573,488],[574,486],[575,486],[577,486],[579,484],[580,482],[582,480],[583,479],[585,478],[586,476],[587,474],[589,472],[590,471],[591,469],[592,467],[592,466],[593,464],[595,462],[596,459],[597,457],[599,454],[599,454],[600,451],[600,449],[602,446],[603,446],[604,443],[605,441],[606,439],[606,438],[607,435],[608,433],[608,431],[610,430],[610,426],[612,425],[612,422],[612,420],[612,419],[613,418],[614,415],[615,414],[616,411],[616,410],[616,407],[616,406],[616,404],[616,402],[616,399],[616,398],[617,395],[617,394],[617,392],[617,390],[617,388],[617,386],[617,384],[617,382],[617,380],[617,378],[617,375],[617,374],[617,371],[617,369],[617,368],[617,362],[617,362],[617,359],[617,357],[616,356],[616,354],[616,351],[616,350],[616,348],[616,346],[615,344],[614,342],[613,339],[613,338],[612,336],[611,334],[610,331],[609,330],[608,328],[608,326],[608,324],[607,321],[607,319],[605,318],[604,314],[603,312],[602,311],[601,309],[601,307],[600,306],[600,304],[599,302],[598,298],[596,296],[596,294],[594,292],[593,290],[593,289],[593,286],[592,285],[592,283],[590,282],[588,280],[588,278],[587,277],[586,275],[585,273],[584,272],[584,271],[581,267],[581,266],[580,265],[580,262],[579,261],[577,261],[577,259],[576,258],[575,256],[573,254],[572,253],[571,252],[570,251],[568,249],[567,248],[566,246],[564,245],[563,244],[562,242],[560,241],[559,239],[558,238],[556,238],[555,236],[552,235],[551,234],[549,233],[548,232],[545,231],[542,230],[541,229],[539,226],[536,226],[535,223],[532,222],[529,222],[528,221],[526,219],[523,218],[521,217],[519,215],[517,214],[515,213],[512,212],[509,210],[507,210],[506,209],[503,208],[501,207],[498,206],[496,206],[495,205],[492,204],[490,203],[488,202],[487,202],[485,202],[483,202],[482,202],[479,201],[477,200],[476,199],[474,199],[472,199],[469,198],[468,198],[466,198],[463,198],[460,198],[460,198],[457,198],[456,198],[456,198],[454,198],[452,198],[451,198],[449,198],[448,198],[447,198],[445,198],[443,198],[442,198],[440,198],[440,198],[439,198],[438,198],[437,198],[436,198],[435,198],[433,198],[432,198],[432,198],[430,198],[428,198],[428,198],[427,198],[426,198],[425,198],[424,198],[424,198],[423,198],[422,198],[421,198],[420,198],[420,198],[419,198],[418,198],[417,198]],
        [[328,308],[329,307],[329,306],[330,306],[330,306],[331,306],[332,306],[332,305],[332,304],[332,303],[333,302],[334,302],[335,302],[336,302],[336,301],[337,300],[337,299],[339,299],[340,298],[342,298],[343,297],[343,296],[344,296],[345,294],[346,294],[348,294],[348,293],[349,293],[349,292],[350,291],[352,290],[352,290],[352,289],[354,288],[355,287],[356,287],[356,286],[357,285],[358,284],[359,283],[359,282],[360,282],[362,281],[363,279],[364,278],[364,277],[365,277],[366,275],[366,274],[367,273],[368,271],[368,270],[369,270],[370,268],[371,266],[372,266],[372,264],[373,262],[373,262],[375,259],[376,258],[377,255],[378,254],[378,254],[378,253],[379,252],[380,250],[380,249],[382,247],[382,246],[384,245],[384,244],[384,242],[385,241],[387,238],[388,237],[388,236],[388,235],[389,234],[390,233],[390,232],[390,231],[390,230],[391,230],[392,229],[392,228],[392,226],[393,226],[393,225],[394,223],[394,222],[395,222],[396,220],[396,219],[396,218],[396,218],[396,217],[396,216],[398,216],[398,215],[398,214],[399,214],[400,214],[400,213],[400,211],[400,210],[401,210],[401,210],[401,209],[402,208],[402,207],[403,206],[403,206],[403,205],[403,206],[403,206],[403,207],[403,208],[403,209],[403,210],[403,210],[403,211],[403,213],[403,214],[403,214],[403,216],[404,217],[404,218],[404,219],[404,220],[404,222],[404,224],[404,226],[404,227],[404,229],[404,230],[404,230],[404,233],[404,234],[404,236],[404,237],[404,239],[405,241],[405,242],[405,243],[405,245],[405,246],[405,249],[406,250],[406,252],[406,254],[406,255],[406,257],[406,259],[406,261],[406,262],[406,265],[406,267],[406,268],[406,270],[406,273],[406,275],[406,277],[406,279],[406,282],[406,283],[406,288],[406,290],[406,292],[406,294],[406,296],[406,298],[406,300],[406,302],[406,304],[406,306],[406,308],[406,310],[406,312],[406,313],[406,315],[406,317],[406,318],[406,320],[406,322],[406,324],[406,326],[406,326],[406,328],[406,329],[406,331],[406,333],[406,334],[406,336],[406,337],[406,338],[406,340],[406,342],[406,342],[406,344],[406,345],[406,347],[406,348],[406,350],[406,351],[406,352],[406,354],[406,355],[406,358],[406,359],[406,360],[406,362],[406,362],[406,364],[406,365],[406,366],[406,368],[406,370],[406,371],[406,372],[406,374],[406,376],[406,377],[406,378],[406,381],[406,382],[406,383],[406,384],[406,386],[406,388],[406,389],[406,390],[406,392],[406,394],[406,395],[406,397],[406,399],[406,401],[406,402],[406,403],[406,405],[406,407],[406,408],[406,409],[406,411],[406,413],[406,415],[406,416],[406,418],[406,418],[406,420],[406,421],[406,422],[406,423],[406,424],[406,425],[406,426],[406,427],[406,429],[406,430],[406,431],[406,433],[406,434],[406,434],[406,435],[406,436],[290,448],[291,448],[292,448],[292,448],[293,448],[294,448],[295,448],[296,448],[297,448],[298,448],[299,448],[300,448],[300,448],[301,448],[302,448],[304,448],[304,448],[306,448],[308,448],[309,448],[310,448],[312,448],[313,448],[314,448],[316,448],[317,448],[320,447],[320,447],[322,447],[324,447],[326,446],[328,446],[330,446],[332,446],[334,446],[336,446],[339,446],[340,446],[344,446],[345,446],[348,446],[351,446],[353,446],[356,446],[358,446],[360,446],[364,446],[367,446],[369,446],[372,446],[375,446],[379,446],[381,446],[384,446],[388,446],[392,445],[394,445],[397,445],[399,445],[404,444],[406,444],[409,444],[412,444],[416,444],[418,444],[420,444],[424,444],[425,443],[428,443],[431,443],[433,443],[436,443],[439,443],[440,443],[443,443],[446,443],[448,443],[450,443],[452,443],[456,443],[457,443],[459,443],[462,443],[464,443],[465,443],[468,443],[469,443],[472,443],[472,443],[474,443],[476,443],[476,443],[477,443],[480,443],[480,443],[482,443],[483,443],[484,443],[485,443],[486,443],[487,443],[488,443],[488,443],[489,443],[490,443],[491,443],[492,443],[492,443],[493,443],[494,443],[495,443],[496,443],[496,443],[497,443],[498,443],[499,443],[500,443]],
        [[310,306],[310,307],[310,306],[310,306],[309,305],[309,304],[309,302],[309,301],[309,300],[309,298],[309,297],[309,296],[309,295],[309,294],[309,294],[309,292],[309,291],[309,290],[309,289],[309,288],[309,287],[309,286],[310,286],[310,284],[310,283],[310,282],[311,282],[311,281],[311,280],[312,279],[312,278],[312,278],[312,277],[313,276],[313,275],[313,274],[314,273],[315,273],[315,271],[316,270],[316,269],[317,267],[318,266],[319,266],[319,265],[319,264],[320,263],[320,262],[321,261],[322,260],[322,259],[323,258],[324,258],[324,257],[324,256],[324,255],[325,255],[326,254],[326,254],[327,253],[328,252],[329,251],[329,250],[330,250],[332,249],[332,248],[333,247],[334,247],[335,246],[336,246],[336,246],[336,245],[338,245],[340,244],[340,243],[342,242],[343,242],[344,242],[346,240],[347,239],[348,239],[349,239],[351,238],[351,238],[352,238],[353,238],[355,237],[356,237],[356,237],[358,234],[359,234],[360,234],[363,234],[364,234],[365,234],[367,234],[368,234],[368,234],[369,233],[371,233],[375,233],[376,233],[378,233],[380,233],[380,233],[381,233],[383,233],[384,233],[385,233],[386,233],[388,233],[388,233],[389,233],[390,233],[392,233],[393,233],[394,234],[396,234],[396,234],[396,234],[399,235],[400,236],[400,236],[401,237],[402,238],[402,238],[404,238],[404,238],[405,239],[407,241],[408,242],[408,244],[410,244],[411,246],[412,246],[412,247],[413,248],[413,250],[414,250],[415,251],[415,252],[416,253],[416,254],[416,255],[418,256],[419,258],[420,259],[420,260],[420,261],[420,262],[421,262],[422,264],[423,266],[423,266],[424,267],[424,269],[424,270],[425,271],[426,273],[427,274],[427,276],[428,278],[428,278],[430,281],[431,283],[431,284],[431,286],[432,288],[432,289],[432,291],[432,294],[432,295],[432,298],[432,300],[433,303],[433,304],[433,306],[433,309],[433,310],[433,314],[433,316],[433,318],[433,320],[433,324],[433,326],[433,328],[433,330],[433,334],[433,337],[433,338],[433,342],[432,344],[432,346],[432,348],[432,351],[432,354],[431,357],[430,357],[428,359],[428,361],[427,363],[425,365],[425,368],[424,370],[423,370],[422,373],[420,375],[420,377],[419,378],[418,380],[416,382],[415,383],[414,385],[413,386],[412,389],[412,390],[409,391],[408,394],[408,395],[406,396],[404,398],[403,400],[400,402],[400,403],[397,406],[396,406],[393,408],[392,410],[390,412],[388,414],[386,416],[384,417],[382,418],[380,422],[379,423],[376,424],[374,426],[372,429],[371,429],[368,432],[366,433],[364,434],[362,436],[360,438],[357,440],[354,442],[352,443],[350,445],[348,446],[346,448],[344,449],[342,449],[340,450],[338,452],[336,454],[333,455],[332,456],[328,458],[325,459],[324,460],[321,462],[320,462],[317,463],[315,465],[312,466],[310,468],[308,468],[305,470],[304,470],[301,470],[300,472],[298,473],[296,473],[294,474],[293,474],[292,475],[291,475],[289,476],[288,476],[288,477],[287,477],[286,478],[285,478],[284,478],[284,478],[284,479],[285,479],[286,479],[287,479],[288,479],[288,479],[289,479],[290,479],[291,479],[292,479],[292,479],[294,479],[295,479],[296,479],[298,479],[300,479],[301,479],[302,479],[304,479],[305,479],[308,479],[309,479],[312,479],[315,479],[316,479],[319,479],[321,479],[323,479],[326,479],[329,479],[331,479],[334,479],[337,479],[340,479],[342,479],[346,479],[349,479],[353,479],[356,479],[361,479],[364,479],[368,479],[371,479],[376,479],[379,479],[383,479],[385,479],[389,479],[393,479],[398,479],[402,479],[405,479],[410,479],[414,479],[420,479],[423,479],[428,479],[431,479],[435,479],[439,479],[441,479],[445,479],[448,479],[452,478],[456,478],[459,478],[463,478],[465,478],[468,478],[470,478],[474,478],[476,478],[477,478],[480,478],[483,478],[484,478],[487,478],[488,478],[488,478],[489,478],[491,478],[492,478],[492,478],[493,478],[494,478]],
        // [[293,226],[294,226],[294,226],[294,225],[294,224],[295,224],[296,223],[296,222],[296,222],[296,222],[296,221],[297,220],[297,219],[298,218],[299,218],[300,217],[300,216],[301,215],[301,214],[303,214],[303,213],[304,212],[304,212],[305,212],[306,211],[307,211],[308,210],[308,210],[308,210],[310,209],[312,209],[312,208],[313,207],[315,207],[316,206],[317,206],[319,206],[320,206],[321,206],[322,206],[324,206],[325,206],[326,206],[328,206],[330,206],[332,206],[333,206],[335,206],[337,206],[339,206],[340,206],[343,206],[345,206],[346,206],[348,206],[350,206],[352,206],[354,206],[356,206],[357,206],[360,206],[362,206],[364,206],[366,206],[368,207],[371,207],[372,208],[375,209],[376,210],[380,210],[381,211],[383,213],[385,213],[388,214],[390,215],[392,216],[396,218],[398,219],[401,219],[404,222],[405,223],[408,224],[410,226],[412,226],[415,228],[416,229],[418,230],[420,232],[423,233],[424,234],[425,235],[427,236],[428,238],[430,239],[431,241],[432,243],[434,244],[436,246],[436,247],[437,250],[438,251],[440,253],[440,254],[441,257],[442,258],[443,258],[444,261],[444,263],[444,265],[446,266],[447,268],[448,270],[448,272],[448,273],[448,275],[448,278],[449,278],[450,281],[450,282],[450,283],[450,286],[450,287],[450,289],[450,290],[450,292],[450,293],[450,294],[450,296],[450,297],[450,298],[450,299],[450,300],[450,302],[450,303],[450,304],[449,306],[449,306],[448,307],[448,308],[448,310],[447,312],[445,313],[444,314],[444,314],[444,315],[444,317],[444,318],[442,318],[440,320],[440,322],[439,322],[438,323],[437,324],[437,325],[436,326],[435,326],[433,329],[432,330],[432,330],[429,332],[429,333],[427,334],[426,335],[423,338],[421,338],[420,339],[419,340],[416,342],[415,342],[413,343],[411,344],[408,346],[408,346],[406,348],[404,349],[400,349],[399,351],[397,352],[395,353],[393,354],[391,354],[389,355],[387,356],[384,357],[382,358],[380,358],[379,358],[376,358],[373,359],[370,360],[369,361],[368,361],[366,362],[364,362],[362,362],[361,362],[360,362],[358,362],[357,362],[356,362],[354,362],[352,362],[352,362],[352,363],[352,363],[353,363],[355,363],[356,363],[357,363],[358,363],[359,363],[360,363],[361,363],[362,364],[364,364],[365,364],[366,365],[368,365],[369,365],[371,365],[372,366],[373,366],[375,366],[376,366],[380,366],[381,367],[383,367],[384,367],[385,367],[388,368],[390,369],[392,370],[393,370],[396,372],[397,372],[400,373],[401,374],[404,374],[407,375],[409,376],[412,378],[413,379],[416,381],[419,382],[421,383],[424,385],[425,387],[428,388],[431,388],[433,390],[436,391],[438,393],[441,394],[443,396],[444,398],[448,399],[450,401],[452,401],[456,402],[457,405],[458,406],[461,408],[464,408],[465,410],[467,412],[468,413],[470,414],[472,414],[472,417],[475,418],[476,420],[476,421],[478,422],[479,422],[480,423],[480,426],[481,426],[483,427],[483,430],[484,431],[484,433],[485,434],[486,435],[487,438],[488,438],[488,439],[488,441],[488,443],[489,445],[489,446],[489,447],[489,449],[489,450],[489,452],[490,454],[490,455],[490,458],[490,458],[490,460],[490,462],[490,463],[490,466],[490,467],[490,469],[489,470],[489,471],[488,474],[488,476],[488,478],[488,480],[486,482],[485,484],[484,487],[484,489],[483,491],[482,494],[480,496],[479,499],[478,502],[477,504],[477,506],[475,510],[474,512],[472,516],[470,518],[469,521],[467,524],[466,527],[464,530],[464,533],[460,536],[459,538],[457,542],[456,545],[456,546],[452,550],[452,552],[450,554],[448,558],[447,560],[444,563],[443,566],[442,568],[440,570],[439,571],[436,574],[436,575],[434,578],[432,579],[429,581],[428,581],[427,582],[424,584],[422,586],[420,586],[418,588],[417,589],[416,589],[413,590],[410,591],[408,592],[407,592],[405,593],[403,593],[402,593],[400,593],[397,593],[396,593],[394,593],[391,593],[390,593],[387,593],[384,593],[383,593],[380,593],[378,593],[376,592],[372,592],[370,590],[368,590],[364,589],[363,588],[360,588],[356,588],[355,588],[351,588],[350,587],[346,587],[344,586],[341,585],[337,584],[335,583],[333,582],[328,582],[328,581],[324,580],[322,579],[320,579],[317,578],[315,578],[312,577],[309,577],[307,574],[304,574],[302,574],[301,574],[299,573],[297,572],[296,571],[294,571],[292,570],[289,570],[289,569],[287,569],[285,567],[284,567],[282,566],[281,565],[280,565],[280,565],[279,564],[278,563],[277,563],[276,562],[276,562]],
        [[366,182],[367,182],[368,182],[368,181],[369,180],[369,179],[371,179],[372,179],[373,178],[374,178],[374,177],[375,177],[376,177],[376,175],[378,175],[379,175],[380,174],[380,174],[381,174],[382,174],[384,173],[384,173],[385,173],[387,172],[388,171],[390,171],[390,170],[391,170],[392,170],[393,170],[395,170],[396,169],[396,169],[397,169],[398,169],[399,168],[400,168],[400,168],[402,168],[404,168],[404,168],[406,168],[408,167],[409,167],[410,167],[411,167],[412,167],[413,167],[415,167],[416,167],[417,167],[418,167],[420,167],[420,167],[421,167],[423,167],[424,167],[424,166],[426,166],[428,166],[429,166],[430,166],[432,166],[433,166],[435,166],[436,166],[437,167],[438,167],[439,167],[440,167],[441,168],[443,169],[444,169],[444,170],[445,170],[447,170],[448,170],[449,171],[450,171],[452,172],[453,173],[454,173],[455,173],[457,174],[459,174],[460,175],[460,176],[462,176],[463,177],[464,178],[465,178],[466,179],[468,179],[468,179],[470,179],[471,180],[471,181],[472,182],[474,182],[476,183],[477,184],[477,185],[479,185],[480,185],[480,186],[482,186],[483,187],[484,188],[485,189],[486,190],[487,190],[488,190],[488,190],[489,191],[490,191],[491,192],[492,192],[492,192],[492,194],[493,194],[494,194],[495,194],[496,195],[496,196],[497,196],[498,197],[499,198],[499,198],[499,199],[500,200],[500,200],[500,201],[501,202],[501,203],[502,203],[503,205],[503,206],[503,206],[504,207],[504,208],[504,209],[504,210],[504,210],[504,211],[504,212],[504,214],[504,215],[504,216],[504,217],[503,218],[503,218],[502,219],[501,221],[501,222],[500,222],[500,222],[499,223],[499,224],[499,225],[498,226],[497,226],[496,227],[496,227],[495,227],[494,228],[494,229],[492,230],[492,230],[492,230],[491,231],[490,231],[488,232],[488,233],[486,234],[484,234],[483,234],[482,235],[481,236],[480,236],[480,236],[479,237],[477,238],[476,238],[475,238],[474,238],[473,238],[472,238],[472,238],[472,239],[470,239],[469,239],[468,240],[467,240],[466,241],[465,241],[464,241],[463,241],[461,242],[460,242],[460,242],[459,242],[457,242],[456,242],[456,242],[454,242],[452,242],[451,242],[450,242],[449,242],[448,242],[448,242],[448,242],[446,242],[445,242],[445,241],[446,241],[447,241],[448,241],[448,241],[449,241],[451,242],[452,242],[452,242],[454,242],[455,242],[455,243],[456,243],[457,244],[458,244],[459,244],[460,244],[460,244],[461,246],[463,246],[463,246],[464,246],[465,247],[466,248],[468,250],[468,250],[471,250],[474,252],[474,253],[476,254],[478,254],[478,255],[480,256],[481,257],[482,257],[484,258],[484,258],[484,258],[484,259],[485,260],[487,261],[488,261],[490,262],[491,263],[492,263],[492,265],[494,266],[496,266],[496,267],[496,267],[499,268],[501,270],[502,271],[503,272],[504,273],[504,274],[506,274],[508,277],[508,278],[508,279],[510,279],[511,280],[512,281],[513,282],[514,282],[514,283],[514,284],[516,285],[517,285],[517,286],[519,287],[519,288],[520,290],[520,290],[520,290],[521,292],[522,292],[523,294],[524,295],[524,296],[524,296],[525,298],[525,299],[526,300],[526,301],[527,302],[528,303],[528,304],[528,306],[529,306],[530,307],[531,308],[531,309],[531,310],[531,311],[532,312],[532,313],[532,314],[533,314],[533,315],[533,316],[533,317],[533,318],[533,318],[534,319],[534,320],[534,321],[534,322],[534,322],[534,323],[534,324],[534,325],[534,326],[534,326],[534,327],[534,329],[533,330],[533,330],[532,332],[532,334],[532,335],[531,336],[531,337],[530,338],[530,339],[530,340],[529,341],[528,342],[527,343],[527,345],[526,345],[525,346],[525,346],[524,347],[524,349],[522,350],[521,351],[520,351],[520,353],[517,354],[517,354],[516,355],[515,356],[514,357],[513,358],[512,358],[511,358],[509,358],[508,359],[508,360],[506,360],[504,360],[504,361],[503,362],[501,362],[500,363],[498,363],[496,363],[495,364],[494,364],[493,364],[492,364],[490,365],[489,365],[488,366],[487,366],[486,366],[485,366],[484,366],[482,366],[481,366],[480,366],[480,366],[479,366],[478,366],[477,366],[476,366],[476,366],[474,366],[473,366],[472,366],[470,366],[469,366],[468,366],[468,366],[466,366],[465,366],[464,366],[461,365],[460,365],[459,364],[457,364],[456,364],[453,364],[452,363],[452,362],[450,362],[448,361],[446,361],[445,360],[444,360],[442,359],[440,358],[439,358],[437,358],[435,357],[432,356],[432,355],[431,354],[429,354],[427,353],[426,352],[424,352],[424,352],[420,350],[419,349],[417,348],[415,347],[413,346],[411,346],[410,345],[408,343],[407,343],[405,342],[404,342],[402,339],[401,339],[400,339],[398,338],[397,338],[394,335],[392,334],[391,333],[389,332],[388,331],[388,330],[388,330],[387,330],[387,329],[387,328],[386,328],[386,327]],
        [[357,203],[357,204],[357,205],[357,206],[357,206],[357,207],[357,209],[356,210],[356,210],[356,212],[356,214],[355,216],[354,216],[353,218],[352,221],[352,222],[352,223],[352,226],[351,226],[349,229],[348,231],[348,234],[346,234],[346,238],[345,240],[345,242],[344,243],[343,246],[342,249],[341,252],[340,254],[339,256],[338,259],[337,262],[336,263],[334,267],[333,270],[332,272],[332,274],[331,276],[330,278],[328,282],[325,290],[324,292],[323,294],[323,294],[322,297],[321,299],[320,301],[320,302],[320,303],[319,306],[318,307],[318,309],[316,310],[316,312],[316,314],[316,314],[315,316],[314,318],[313,321],[312,322],[312,323],[312,326],[312,326],[311,328],[310,330],[310,330],[309,332],[308,334],[308,334],[308,336],[308,338],[307,339],[307,340],[307,341],[307,342],[307,342],[306,343],[306,344],[305,345],[305,346],[305,346],[305,347],[306,348],[307,348],[308,348],[309,349],[311,349],[312,349],[312,349],[313,349],[315,350],[316,350],[317,350],[319,351],[320,351],[321,351],[324,351],[324,351],[327,351],[329,351],[330,352],[332,352],[336,352],[336,352],[339,353],[342,353],[344,353],[347,353],[349,354],[352,354],[355,354],[357,354],[360,354],[364,354],[366,354],[370,355],[373,355],[376,355],[380,355],[384,355],[388,355],[390,355],[393,355],[397,355],[403,355],[406,355],[411,355],[413,355],[418,355],[421,355],[426,355],[429,356],[433,356],[436,356],[441,357],[444,357],[448,357],[451,357],[456,357],[459,357],[463,357],[465,357],[470,358],[472,358],[476,358],[480,358],[483,358],[486,358],[489,358],[492,358],[494,358],[497,358],[500,358],[502,358],[504,358],[506,358],[508,358],[510,358],[511,358],[513,358],[515,358],[516,358],[518,358],[519,358],[520,358],[520,358],[518,178],[518,179],[518,181],[519,182],[519,182],[519,183],[519,184],[519,186],[519,186],[519,189],[519,190],[519,191],[519,192],[519,193],[519,194],[519,196],[519,197],[520,198],[520,199],[520,200],[520,202],[520,202],[520,204],[520,206],[520,207],[520,209],[520,211],[520,212],[520,214],[520,214],[520,217],[520,218],[520,220],[520,222],[520,223],[520,225],[520,227],[520,229],[520,230],[520,232],[520,234],[520,236],[520,238],[520,239],[520,241],[520,243],[520,244],[520,246],[520,249],[520,250],[520,252],[520,253],[520,255],[520,257],[520,258],[520,260],[520,262],[520,262],[520,264],[520,265],[520,267],[520,269],[520,270],[520,271],[520,274],[520,274],[520,276],[520,277],[520,278],[520,281],[520,282],[520,283],[520,285],[520,286],[520,288],[520,289],[520,291],[520,293],[520,294],[520,296],[520,298],[520,299],[520,301],[520,302],[520,304],[520,306],[520,307],[520,310],[520,313],[520,315],[520,318],[520,319],[520,322],[520,324],[520,328],[520,331],[520,332],[520,335],[520,338],[520,339],[520,341],[520,343],[520,344],[520,347],[520,350],[520,350],[520,353],[520,355],[520,357],[520,358],[520,360],[520,362],[520,364],[520,366],[520,368],[520,370],[520,371],[520,374],[520,376],[520,377],[520,379],[520,382],[520,383],[520,386],[520,388],[520,390],[520,392],[520,394],[520,396],[520,398],[520,401],[520,402],[520,405],[520,407],[520,409],[520,411],[520,414],[520,415],[520,418],[520,420],[520,422],[520,424],[520,426],[520,427],[520,430],[520,433],[520,434],[520,437],[520,440],[520,441],[520,443],[520,446],[520,447],[520,450],[520,453],[520,454],[520,455],[520,458],[520,458],[520,461],[520,463],[520,465],[520,466],[520,467],[520,470],[520,471],[520,472],[520,474],[520,476],[520,477],[520,478],[521,480],[521,481],[521,482],[522,482],[522,485],[522,486],[522,487],[522,489],[522,490],[523,493],[523,494],[523,494],[523,495],[523,497],[523,498],[523,499],[523,500],[523,502],[523,503],[523,504],[523,505],[523,506],[523,507],[523,509],[523,511],[523,512],[523,514],[524,514],[524,516],[524,517],[524,518],[524,518],[524,519],[524,521],[524,522],[524,523],[524,524],[524,525],[524,526],[524,528],[524,530],[524,531],[524,532],[524,533],[524,534],[524,534],[524,535],[524,536],[524,537],[524,538],[524,538],[524,539],[524,539],[524,540],[524,542],[524,542],[524,543],[524,544],[524,545],[524,546],[524,546],[524,547],[524,548],[524,549],[525,550],[525,550],[525,551],[525,552],[525,554],[525,554],[525,555],[525,556],[525,557],[525,558],[525,558],[525,559],[526,560],[526,561],[526,562],[526,562],[526,563],[526,564]],
        [[505,210],[504,210],[504,210],[502,210],[501,210],[500,210],[500,210],[499,210],[498,210],[497,210],[496,210],[496,210],[494,210],[492,210],[492,210],[491,210],[490,210],[489,210],[488,209],[486,209],[484,209],[484,209],[481,209],[480,209],[479,209],[476,209],[475,209],[474,209],[472,209],[471,209],[468,208],[468,208],[464,208],[462,208],[461,208],[459,208],[457,208],[456,208],[454,208],[452,207],[450,207],[448,207],[447,207],[444,207],[442,207],[440,207],[438,207],[436,207],[434,207],[431,207],[429,207],[427,206],[424,206],[423,206],[420,206],[418,206],[415,206],[412,206],[408,206],[406,206],[404,206],[401,205],[399,205],[397,205],[395,204],[392,204],[390,203],[388,203],[385,203],[383,202],[381,202],[379,202],[378,202],[376,202],[374,202],[373,201],[371,201],[369,201],[368,200],[367,200],[366,200],[364,200],[363,200],[362,200],[361,200],[360,199],[360,199],[358,199],[357,199],[356,199],[356,198],[355,198],[354,198],[352,198],[351,198],[350,198],[349,198],[348,198],[348,197],[347,197],[346,197],[346,196],[344,196],[344,196],[343,195],[342,195],[341,194],[340,194],[340,194],[340,196],[340,197],[340,198],[339,198],[339,199],[339,200],[338,201],[338,202],[338,203],[338,204],[338,205],[338,206],[338,208],[337,209],[337,210],[337,211],[337,214],[337,214],[337,216],[336,218],[336,219],[336,220],[335,222],[335,222],[335,223],[335,226],[335,227],[335,228],[334,230],[334,231],[334,232],[334,234],[333,235],[333,237],[332,238],[332,240],[332,241],[332,242],[332,244],[332,246],[332,248],[332,249],[332,251],[331,253],[331,254],[331,257],[331,259],[331,262],[330,263],[330,265],[330,266],[330,269],[330,270],[330,272],[329,273],[329,275],[329,278],[329,278],[329,281],[329,282],[329,284],[329,286],[329,287],[329,290],[328,290],[328,292],[328,295],[328,296],[328,298],[328,300],[328,302],[328,305],[328,306],[328,308],[327,310],[327,312],[326,314],[326,315],[326,317],[326,319],[326,321],[326,322],[325,324],[325,326],[325,329],[325,330],[325,333],[325,334],[325,335],[325,338],[325,339],[324,340],[324,342],[324,344],[324,345],[324,346],[324,347],[323,349],[323,350],[322,351],[322,353],[322,354],[321,356],[321,357],[321,358],[321,359],[321,361],[321,362],[320,362],[320,364],[320,365],[320,367],[320,369],[320,370],[320,371],[320,374],[320,374],[320,375],[320,376],[319,378],[319,378],[319,379],[319,380],[319,381],[319,382],[320,382],[320,381],[320,380],[320,379],[320,378],[320,378],[321,377],[321,376],[322,375],[323,375],[323,374],[324,374],[324,374],[325,373],[326,372],[328,372],[328,371],[328,370],[330,370],[331,370],[332,370],[335,369],[336,369],[336,368],[338,368],[340,367],[341,366],[343,366],[344,366],[345,366],[349,366],[350,366],[351,365],[354,365],[356,365],[359,365],[360,365],[362,365],[365,365],[368,365],[370,365],[372,365],[375,365],[377,365],[380,365],[382,365],[385,365],[388,365],[391,365],[393,365],[396,365],[400,365],[401,365],[404,365],[407,365],[410,366],[414,367],[416,367],[420,368],[423,369],[427,370],[430,370],[433,370],[437,371],[440,372],[443,374],[446,374],[450,377],[453,378],[456,378],[459,378],[464,381],[466,382],[468,382],[472,385],[476,385],[480,386],[482,387],[488,390],[489,391],[492,393],[496,394],[499,395],[503,398],[506,399],[510,400],[514,402],[516,403],[519,406],[521,406],[524,408],[528,410],[530,412],[532,414],[535,415],[537,416],[540,418],[541,420],[544,421],[545,422],[548,424],[551,426],[552,427],[555,429],[556,431],[557,432],[559,434],[560,434],[563,437],[563,438],[564,440],[565,441],[566,442],[567,443],[568,445],[568,446],[570,447],[571,450],[572,451],[572,452],[572,454],[572,454],[572,456],[573,458],[574,460],[575,462],[575,463],[575,464],[575,465],[576,467],[576,469],[576,470],[576,471],[576,474],[576,474],[576,476],[576,477],[576,478],[576,480],[576,481],[576,482],[575,485],[574,486],[574,487],[574,489],[572,490],[572,491],[572,493],[572,494],[570,495],[570,497],[568,498],[568,500],[568,501],[567,502],[566,504],[565,506],[564,506],[563,507],[562,509],[560,510],[560,511],[559,513],[558,514],[556,514],[555,517],[553,517],[552,518],[552,519],[549,519],[548,521],[547,522],[545,522],[544,524],[543,525],[541,526],[539,526],[536,527],[535,528],[533,528],[531,529],[528,530],[528,531],[524,532],[522,532],[520,534],[513,535],[510,536],[508,536],[504,537],[501,538],[495,538],[492,538],[489,538],[486,538],[483,538],[480,538],[477,538],[470,538],[467,538],[464,538],[460,538],[456,538],[453,538],[449,538],[446,538],[443,538],[439,538],[436,538],[432,538],[429,538],[425,537],[423,537],[417,535],[415,535],[410,534],[408,533],[403,533],[400,531],[395,530],[392,528],[387,526],[384,526],[380,525],[376,523],[372,521],[369,520],[365,518],[363,518],[360,516],[358,514],[355,513],[352,511],[349,510],[347,509],[344,507],[343,506],[341,505],[339,504],[337,504],[336,503],[335,502],[332,501],[331,500],[330,498],[328,498],[328,498],[327,497],[327,496],[326,496],[325,496],[325,495],[325,494],[324,494],[324,494]],
        [[465,116],[464,116],[464,117],[463,117],[462,117],[462,118],[461,118],[460,118],[459,118],[457,119],[456,119],[455,119],[455,120],[454,121],[452,121],[452,121],[451,122],[449,122],[448,123],[448,123],[447,123],[446,124],[445,125],[444,125],[442,126],[440,126],[440,126],[439,127],[437,127],[436,128],[436,128],[434,130],[432,130],[432,130],[431,131],[430,131],[428,132],[428,134],[426,134],[425,135],[424,136],[420,136],[420,137],[419,138],[417,140],[416,140],[414,141],[413,142],[411,144],[409,145],[408,146],[406,147],[404,149],[402,150],[401,150],[397,153],[396,154],[395,156],[393,157],[392,160],[389,162],[387,163],[387,166],[384,168],[383,170],[380,170],[379,174],[377,175],[375,178],[374,179],[373,182],[372,182],[369,185],[368,186],[367,189],[365,190],[364,192],[362,194],[360,195],[360,197],[359,198],[357,199],[356,202],[354,202],[353,205],[352,206],[352,207],[350,209],[348,211],[348,213],[347,214],[345,216],[345,218],[344,220],[343,221],[341,223],[341,225],[340,227],[340,230],[339,232],[338,234],[336,235],[336,238],[335,241],[335,242],[333,245],[332,247],[332,250],[330,254],[329,257],[328,260],[328,262],[327,265],[326,268],[326,270],[325,274],[324,275],[324,279],[323,282],[323,285],[322,288],[322,290],[321,293],[320,295],[320,298],[320,302],[320,303],[319,306],[319,309],[319,312],[318,315],[318,317],[318,319],[318,322],[317,324],[317,327],[317,329],[317,330],[317,334],[316,336],[316,338],[316,340],[316,342],[316,343],[316,346],[316,348],[316,349],[316,351],[316,354],[316,356],[316,357],[316,359],[316,361],[317,362],[318,363],[319,365],[320,366],[320,367],[320,370],[320,371],[321,372],[323,373],[324,375],[324,377],[325,378],[326,378],[327,380],[328,382],[328,382],[328,383],[329,384],[331,384],[332,386],[332,387],[332,389],[333,389],[335,390],[336,391],[337,393],[338,394],[339,395],[340,396],[342,396],[343,397],[344,398],[345,399],[347,399],[348,400],[349,402],[351,402],[352,402],[354,403],[356,403],[356,405],[359,405],[360,405],[362,406],[363,406],[364,406],[365,406],[368,406],[369,406],[370,406],[372,406],[373,406],[374,406],[376,406],[378,406],[380,406],[380,406],[383,406],[385,406],[387,406],[388,406],[391,404],[393,404],[395,403],[396,403],[399,403],[401,402],[403,402],[406,401],[408,400],[411,398],[413,398],[417,397],[420,396],[421,394],[424,394],[427,393],[430,391],[432,390],[436,389],[437,388],[440,386],[443,386],[446,384],[448,383],[451,382],[453,381],[456,379],[457,378],[460,375],[462,374],[464,373],[467,371],[468,370],[470,369],[472,368],[475,367],[476,366],[477,363],[479,362],[481,361],[481,359],[483,358],[484,356],[484,355],[486,353],[487,351],[488,350],[488,348],[488,346],[488,345],[489,343],[490,341],[491,340],[491,338],[492,337],[492,335],[492,334],[492,332],[492,331],[492,330],[492,328],[492,326],[492,325],[492,324],[492,322],[492,321],[492,319],[492,318],[492,317],[492,314],[492,313],[492,312],[492,310],[492,308],[492,307],[491,306],[490,303],[489,302],[489,301],[488,299],[488,298],[488,295],[488,294],[487,293],[486,291],[484,288],[484,287],[484,286],[483,283],[482,282],[481,280],[480,278],[479,275],[478,274],[476,272],[476,270],[476,268],[474,266],[472,264],[471,262],[469,261],[468,258],[468,257],[467,255],[464,254],[463,251],[462,249],[460,249],[460,247],[457,246],[456,244],[455,242],[453,242],[452,241],[451,240],[449,239],[449,238],[448,238],[447,237],[445,237],[444,236],[444,235],[443,235],[442,235],[440,234],[439,234],[439,234],[438,233],[437,233],[436,233],[435,233],[432,232],[432,232],[431,232],[429,231],[428,231],[428,231],[427,231],[426,231],[425,231],[424,231],[422,231],[421,231],[420,231],[420,231],[418,231],[416,232],[416,232],[415,232],[413,232],[412,232],[411,233],[409,233],[408,234],[407,234],[406,234],[404,235],[404,235],[403,235],[401,236],[400,236],[399,237],[398,238],[396,238],[396,239],[394,239],[392,240],[392,242],[391,242],[390,242],[388,243],[388,244],[386,246],[386,246],[384,247],[384,247],[382,248],[380,248],[380,250],[380,250],[378,251],[376,253],[376,253],[374,254],[373,254],[372,255],[372,256],[370,257],[368,258],[368,259],[366,260],[364,260],[362,261],[362,262],[360,263],[360,263],[359,264],[357,265],[356,266],[355,266],[350,269],[350,270],[349,270],[348,271],[348,271],[347,271],[347,272],[345,272],[344,273],[344,274],[344,274],[343,275]],
        [[275,195],[276,195],[276,195],[278,195],[280,195],[280,195],[283,195],[284,195],[285,195],[287,195],[288,195],[290,195],[292,195],[292,195],[294,195],[296,194],[297,194],[299,194],[302,194],[303,194],[304,194],[307,194],[311,194],[312,194],[314,194],[317,194],[319,194],[320,194],[323,194],[325,194],[327,194],[330,194],[332,194],[334,194],[336,194],[339,194],[340,194],[343,194],[345,194],[347,194],[349,194],[352,194],[354,194],[356,194],[360,194],[362,194],[363,194],[366,194],[368,194],[370,194],[372,194],[376,194],[377,194],[380,194],[383,194],[388,194],[390,194],[392,194],[394,194],[396,194],[399,194],[401,194],[403,194],[405,194],[407,194],[410,194],[412,193],[413,193],[416,193],[418,193],[420,193],[421,193],[424,193],[424,193],[426,193],[428,193],[430,193],[432,192],[432,192],[434,192],[436,192],[438,192],[439,192],[440,192],[442,192],[444,192],[444,191],[446,191],[448,191],[449,191],[450,191],[452,191],[453,191],[454,191],[456,191],[457,191],[458,191],[460,191],[460,191],[462,191],[464,191],[464,191],[466,191],[467,191],[468,191],[470,191],[472,191],[472,191],[474,191],[475,191],[476,191],[476,191],[478,191],[479,191],[480,191],[480,191],[481,191],[482,191],[482,192],[482,193],[481,194],[480,194],[480,195],[479,195],[479,196],[478,197],[477,198],[476,198],[475,199],[474,200],[473,201],[472,202],[472,202],[472,202],[470,203],[469,203],[468,204],[468,205],[467,205],[466,206],[464,207],[464,207],[463,209],[462,210],[461,210],[460,210],[459,210],[457,212],[457,213],[456,214],[453,215],[452,216],[452,217],[450,217],[448,219],[445,221],[444,223],[443,223],[441,224],[440,226],[438,226],[437,228],[435,229],[433,230],[432,231],[431,232],[429,232],[427,234],[426,235],[424,236],[422,238],[420,238],[419,239],[417,241],[416,242],[413,242],[412,244],[411,246],[408,246],[407,247],[406,249],[404,249],[401,250],[400,252],[399,253],[397,253],[396,254],[394,255],[392,257],[392,258],[390,258],[389,259],[388,261],[387,261],[386,262],[384,263],[382,264],[381,265],[380,267],[380,267],[378,270],[377,271],[376,273],[375,274],[375,275],[374,276],[372,277],[371,279],[371,281],[370,282],[369,284],[368,286],[367,287],[366,289],[364,290],[364,293],[364,294],[363,294],[361,297],[360,299],[360,300],[360,302],[358,304],[357,306],[356,307],[356,310],[355,311],[354,313],[353,314],[352,316],[351,318],[350,320],[350,321],[348,323],[348,325],[347,326],[347,328],[344,330],[344,331],[343,333],[342,334],[341,336],[340,338],[340,340],[338,342],[337,343],[337,345],[336,346],[335,348],[335,350],[335,351],[334,352],[333,354],[332,356],[332,357],[331,358],[331,360],[330,362],[330,363],[329,365],[328,366],[328,368],[327,369],[326,371],[326,372],[325,374],[325,375],[324,377],[324,378],[323,380],[323,381],[322,382],[321,384],[320,386],[320,386],[320,388],[319,390],[319,390],[318,392],[318,393],[318,394],[317,395],[316,397],[316,398],[316,398],[316,399],[316,400],[316,401],[316,402],[316,402],[316,403],[316,404],[316,405],[315,406],[315,406],[315,407],[315,408],[315,409],[315,410],[305,285],[306,285],[307,285],[308,285],[308,285],[309,285],[310,285],[311,285],[312,285],[312,285],[314,285],[315,285],[316,285],[317,285],[318,285],[320,285],[320,285],[322,285],[323,285],[324,285],[325,285],[327,285],[328,285],[329,285],[331,285],[332,285],[334,285],[336,285],[337,285],[340,285],[341,285],[342,285],[344,285],[348,285],[350,285],[352,285],[353,285],[356,285],[357,285],[360,285],[360,285],[362,285],[364,285],[365,285],[366,285],[368,285],[369,285],[372,285],[372,285],[374,285],[376,285],[377,285],[378,285],[379,285],[380,285],[382,285],[383,285],[384,285],[384,285],[385,285],[386,285],[387,285],[388,285],[388,285],[389,285],[390,285]],
        [[402,499],[402,500],[403,500],[404,500],[404,500],[405,501],[406,501],[407,501],[408,501],[408,501],[410,501],[411,501],[412,501],[412,501],[414,501],[415,501],[416,501],[417,501],[418,501],[419,501],[420,501],[421,501],[423,501],[424,501],[426,501],[427,501],[428,501],[429,501],[430,501],[432,501],[434,501],[436,501],[438,501],[439,501],[440,501],[441,501],[444,501],[445,501],[446,501],[448,501],[450,501],[452,500],[452,500],[455,500],[456,500],[458,500],[459,500],[460,500],[463,500],[464,500],[465,500],[467,500],[469,500],[471,500],[472,500],[474,500],[476,500],[477,500],[479,500],[481,500],[483,500],[484,500],[487,499],[488,499],[489,499],[491,498],[492,498],[494,498],[496,498],[496,496],[498,496],[500,496],[501,496],[502,496],[504,494],[504,494],[506,494],[508,493],[508,492],[510,491],[512,491],[512,490],[514,490],[515,490],[516,489],[517,487],[519,487],[520,486],[521,485],[523,484],[524,483],[525,482],[525,482],[526,480],[527,479],[528,478],[528,478],[530,477],[531,475],[532,474],[532,474],[532,473],[532,472],[533,471],[534,470],[534,469],[535,469],[535,467],[536,467],[536,466],[536,465],[536,463],[536,462],[536,462],[536,461],[536,460],[536,459],[536,458],[536,457],[536,455],[536,454],[536,453],[536,452],[536,451],[536,450],[536,448],[534,446],[533,446],[533,444],[532,443],[532,442],[532,440],[531,438],[531,438],[530,436],[529,434],[528,434],[528,432],[527,430],[525,430],[525,428],[524,426],[524,426],[523,423],[523,422],[521,422],[520,421],[520,420],[519,418],[519,417],[518,415],[516,415],[515,413],[515,412],[513,410],[512,410],[512,408],[511,406],[509,406],[508,405],[506,403],[506,402],[504,402],[503,400],[502,398],[500,398],[499,397],[497,394],[496,394],[495,393],[493,391],[491,390],[490,390],[488,389],[488,386],[485,385],[484,384],[482,383],[480,380],[479,378],[476,378],[474,378],[473,376],[472,374],[468,373],[468,371],[465,370],[463,369],[461,368],[460,366],[458,365],[456,364],[454,363],[453,361],[451,361],[448,360],[448,358],[446,358],[444,356],[442,354],[440,353],[438,352],[437,351],[436,350],[434,350],[431,348],[429,346],[428,345],[426,345],[424,344],[422,342],[421,340],[419,338],[417,338],[415,337],[413,336],[412,334],[409,334],[408,332],[406,331],[404,330],[403,329],[401,328],[400,327],[399,326],[396,325],[395,323],[393,322],[392,321],[389,319],[388,318],[387,318],[385,316],[384,314],[383,313],[380,311],[378,310],[377,309],[376,307],[374,306],[372,304],[371,303],[370,302],[368,300],[368,299],[366,298],[364,296],[364,294],[362,293],[364,297],[364,294],[364,294],[362,292],[361,291],[360,290],[360,288],[359,288],[358,286],[356,284],[356,282],[355,282],[353,280],[352,278],[352,278],[352,276],[352,275],[350,274],[350,274],[349,272],[349,270],[348,270],[348,270],[347,268],[347,267],[347,266],[346,265],[346,264],[345,263],[345,262],[344,262],[344,260],[344,259],[344,258],[343,258],[343,256],[342,255],[342,254],[342,254],[341,254],[341,251],[341,250],[341,248],[341,247],[341,246],[341,245],[341,244],[341,243],[341,242],[341,241],[341,240],[341,239],[341,238],[341,238],[342,236],[342,235],[343,235],[343,234],[343,233],[344,233],[344,232],[344,231],[344,230],[345,230],[346,228],[346,227],[347,226],[347,226],[347,225],[348,224],[348,223],[349,223],[349,222],[350,222],[350,221],[352,221],[352,220],[352,220],[352,219],[353,219],[354,219],[355,218],[356,218],[357,218],[357,217],[359,216],[360,215],[360,215],[361,214],[363,214],[364,213],[364,213],[366,212],[367,211],[368,210],[369,210],[370,210],[372,210],[373,210],[374,209],[376,208],[377,208],[379,208],[380,207],[381,207],[384,206],[385,206],[386,206],[388,206],[391,206],[392,206],[393,206],[396,206],[396,206],[399,206],[400,206],[403,206],[404,206],[406,206],[408,206],[411,206],[412,206],[414,206],[416,206],[418,206],[420,206],[421,206],[423,206],[424,206],[426,206],[428,206],[429,206],[431,206],[432,206],[434,206],[435,206],[436,206],[437,206],[439,207],[440,207],[442,208],[444,208],[444,209],[445,209],[447,209],[448,210],[449,210],[449,211],[451,211],[452,212],[452,213],[453,214],[455,214],[455,214],[456,214],[457,215],[457,217],[458,217],[459,218],[459,218],[460,219],[460,219],[461,221],[462,222],[463,222],[464,224],[464,225],[464,226],[465,227],[466,229],[466,230],[468,231],[469,232],[470,233],[470,234],[472,237],[472,238],[472,238],[474,240],[474,241],[475,242],[476,243],[476,244],[476,244],[476,246],[478,247],[479,248],[479,249],[479,250],[480,250],[480,251],[480,252],[481,253],[481,254],[481,255],[482,257],[482,258],[482,258],[482,259],[482,260],[482,261],[482,262],[482,264],[482,265],[482,266],[482,267],[482,268],[482,270],[482,270],[482,271],[481,274],[481,274],[481,275],[480,277],[480,278],[479,279],[478,281],[477,282],[477,283],[476,285],[475,286],[474,287],[472,289],[472,290],[472,293],[470,294],[470,295],[469,297],[468,298],[467,300],[466,302],[465,303],[464,304],[464,306],[463,307],[461,308],[460,309],[460,311],[458,313],[457,314],[456,314],[456,316],[455,318],[454,319],[452,320],[452,322],[451,323],[451,324],[449,326],[448,326],[447,328],[444,330],[444,332],[443,332],[442,333],[440,334],[440,336],[439,337],[439,338],[437,341],[436,342],[436,343],[435,345],[433,346],[432,346],[432,349],[431,350],[430,351],[428,353],[428,354],[426,357],[425,358],[424,361],[423,362],[422,363],[420,366],[420,368],[420,369],[419,370],[417,372],[416,374],[414,377],[414,378],[413,380],[412,382],[411,382],[410,384],[409,386],[408,387],[407,389],[406,390],[405,390],[404,393],[404,395],[402,396],[401,397],[400,399],[400,401],[399,402],[398,402],[396,404],[396,406],[396,406],[395,407],[393,409],[392,410],[391,412],[390,413],[389,414],[389,414],[388,416],[388,418],[387,418],[386,419],[385,420],[384,421],[384,422],[384,423],[383,425],[382,425],[380,426],[380,428],[380,429],[379,430],[378,430],[378,432],[377,434],[376,434],[376,436],[375,437],[374,437],[373,438],[372,440],[372,441],[372,442],[371,443],[370,444],[370,446],[370,446],[369,447],[368,448],[368,450],[367,451],[367,453],[367,454],[367,455],[366,457],[366,458],[365,459],[365,460],[365,462],[365,463],[364,463],[364,465],[364,466],[364,466],[364,467],[364,468],[364,469],[364,470],[364,470],[364,471],[364,472],[364,473],[364,474],[364,474],[364,476],[365,476],[365,477],[365,478],[366,478],[367,478],[367,479],[368,479],[368,480],[368,480],[370,481],[371,481],[371,482],[372,482],[372,482],[374,482],[375,483],[376,483],[376,483],[378,483],[379,484],[380,484],[382,485],[384,486],[386,486],[388,486],[388,486],[390,486],[392,486],[394,486],[395,486],[396,486],[399,486],[400,487],[402,487],[404,487],[405,487],[407,487],[409,488],[411,488],[413,488],[415,489],[416,489],[419,489],[420,489],[422,489],[424,490],[425,490],[427,490],[429,490],[431,490],[432,490],[433,490],[435,490],[437,490],[438,490],[439,490],[441,490],[442,491],[444,491],[444,491],[445,491],[447,491],[448,491],[448,491],[449,491],[450,491],[452,491],[452,491],[453,491],[454,491]],
        [[431,180],[430,180],[429,180],[428,180],[428,180],[427,180],[426,180],[425,180],[424,180],[424,180],[423,180],[422,180],[421,180],[420,180],[420,180],[419,180],[418,180],[417,180],[416,180],[416,180],[416,181],[414,181],[413,181],[412,182],[412,182],[411,182],[410,182],[410,183],[408,183],[408,183],[408,184],[406,184],[405,184],[404,184],[404,184],[403,185],[401,186],[400,186],[400,187],[399,187],[398,187],[396,189],[396,189],[394,190],[393,190],[391,190],[391,192],[389,193],[388,194],[387,194],[387,194],[385,195],[384,196],[383,197],[382,197],[381,198],[380,198],[380,199],[378,200],[376,201],[376,202],[376,202],[374,202],[374,203],[372,204],[371,205],[370,206],[370,207],[369,208],[368,208],[367,209],[366,210],[365,211],[364,211],[364,213],[363,214],[363,214],[362,215],[361,216],[361,217],[360,217],[360,218],[360,219],[359,220],[359,221],[359,222],[358,224],[358,225],[358,226],[358,228],[357,230],[357,231],[357,232],[357,234],[357,235],[357,236],[357,238],[357,238],[357,240],[357,241],[358,242],[358,244],[358,245],[359,246],[359,246],[360,248],[360,249],[360,250],[362,251],[363,253],[364,254],[364,254],[364,256],[364,257],[366,258],[367,258],[368,260],[368,261],[369,262],[370,264],[370,265],[372,265],[372,266],[373,267],[373,269],[375,269],[376,270],[376,270],[376,272],[377,273],[380,273],[380,274],[381,275],[382,276],[383,276],[384,277],[384,278],[386,278],[388,280],[388,281],[390,282],[392,282],[392,282],[394,283],[394,284],[396,284],[397,286],[399,286],[400,287],[401,288],[402,288],[404,288],[405,288],[406,289],[408,290],[410,290],[412,290],[412,291],[414,291],[416,292],[417,292],[420,292],[422,293],[423,293],[425,293],[428,294],[429,294],[431,294],[432,294],[434,294],[436,294],[438,294],[440,294],[442,294],[444,294],[444,294],[448,294],[449,294],[450,294],[452,294],[454,294],[455,294],[456,294],[459,294],[460,293],[461,292],[463,291],[464,291],[464,290],[467,289],[468,289],[468,289],[469,288],[471,287],[472,286],[472,286],[473,285],[474,284],[474,283],[475,282],[476,282],[477,280],[478,279],[479,278],[479,277],[479,276],[480,274],[481,273],[482,272],[482,270],[483,268],[483,267],[484,266],[485,264],[485,261],[486,259],[486,258],[487,255],[488,254],[488,253],[488,250],[488,248],[489,246],[489,245],[489,242],[490,241],[490,240],[491,238],[491,235],[491,234],[491,233],[491,230],[491,228],[491,227],[492,226],[492,222],[492,222],[492,220],[492,218],[492,216],[492,214],[492,214],[492,211],[492,210],[492,209],[492,207],[492,205],[492,204],[491,202],[490,201],[490,200],[490,198],[489,197],[489,195],[488,194],[488,192],[487,191],[487,190],[486,188],[485,186],[485,185],[485,184],[484,182],[484,181],[482,179],[481,179],[481,178],[480,175],[480,175],[479,174],[478,173],[477,172],[477,170],[476,169],[475,167],[475,166],[474,165],[473,165],[473,163],[472,163],[472,162],[472,162],[472,161],[471,161],[471,160],[470,160],[469,158],[468,158],[468,157],[468,158],[468,158],[469,158],[469,160],[470,161],[471,161],[471,162],[472,163],[473,165],[474,167],[474,170],[475,170],[476,172],[477,173],[478,175],[480,178],[480,180],[480,180],[480,182],[481,185],[483,186],[484,187],[484,190],[485,192],[485,193],[486,196],[487,198],[487,199],[487,201],[488,203],[488,206],[489,208],[490,211],[492,214],[492,216],[492,219],[493,221],[494,223],[494,226],[494,227],[495,230],[495,233],[495,235],[495,238],[496,240],[496,242],[496,246],[496,248],[497,251],[497,254],[498,257],[498,259],[498,262],[499,266],[499,268],[499,271],[499,273],[499,276],[499,279],[499,281],[500,283],[500,286],[500,290],[500,292],[500,295],[500,299],[500,302],[500,305],[500,307],[500,310],[500,314],[500,317],[500,319],[500,323],[500,326],[500,330],[500,334],[500,336],[499,339],[499,342],[498,345],[498,348],[497,352],[496,354],[496,357],[496,359],[494,362],[494,365],[494,367],[493,369],[492,372],[491,374],[489,375],[488,378],[488,380],[487,382],[485,384],[485,386],[484,387],[483,388],[482,390],[481,391],[480,394],[480,394],[479,397],[477,398],[476,400],[475,401],[475,402],[475,403],[473,405],[472,406],[472,406],[471,409],[471,410],[469,411],[469,412],[468,413],[468,414],[467,415],[466,417],[465,418],[464,418],[463,420],[463,422],[462,423],[461,425],[460,426],[460,428],[458,430],[456,431],[456,433],[455,435],[453,437],[453,438],[452,440],[451,442],[450,443],[448,446],[447,447],[445,450],[444,453],[443,454],[442,456],[440,458],[440,458],[439,459],[437,462],[437,462],[436,463],[433,465],[433,466],[432,467],[431,470],[429,470],[428,470],[427,472],[425,473],[424,474],[424,474],[423,475],[422,475],[421,475],[420,476],[420,476],[420,477],[419,478],[418,478],[416,478],[416,479],[415,479],[414,480],[414,481],[413,481],[412,481],[412,481],[411,481],[409,481],[408,482],[408,482],[407,482],[406,482],[405,482],[404,482],[404,483],[404,483],[403,483],[402,483],[401,483],[400,483],[400,484],[400,484],[399,484],[398,484],[397,484],[396,484]],
    ];

    function normalize() {
        const setOrigin = o => p => [ p[0] - o[0], p[1] - o[1] ];
        const scaleBy   = s => p => [ p[0] * s, p[1] * s ];
        const differentFrom = a => b => a[0] != b[0] || a[1] != b[1];
        const takeEvery = step => (_, i) => i % step == 0;
        const height = 200;

        for (let i = 0; i < glyphs.length; i++) {
            const glyph = glyphs[i];
            const origin = glyph.reduce(minvec, [1e9, 1e9]);
            const bound_ = glyph.reduce(maxvec, [0, 0]);
            const bound  = setOrigin (origin) (bound_);

            glyphs[i] =
                glyph
                .filter (differentFrom(glyph[glyph.length-1]))
                .filter (takeEvery(2))
                .map (setOrigin(origin))
                .map (scaleBy(height / bound[1]));
        }
    }

    const noise = x => 2*x*Math.random() - x;
    const addNoise = x => p => [
        p[0] + noise(x),
        p[1] + noise(x)
    ];

    return { recording, glyphs, normalize, noise, addNoise };
})();

let variables = {
    container: document.getElementById('variables'),

    range(label, initial, min, max) {
        let value = initial;

        let valueNode = html('span');
        valueNode.innerText = value; 

        let input = html('input', {
            min, max, value,
            'type': 'range',
            'style': 'margin-left: 0.8rem; margin-right: 0.8rem;',
        });
        input.addEventListener('input', () => {
            value = +input.value;
            valueNode.innerText = value;
        });

        let labelNode = html('label', {
            'style': 'display: flex;'
        }, text(label), input, valueNode);

        this.container.appendChild(labelNode);
        return () => value;
    },
};

const rand = (min, max) => Math.random() * (max - min) + min;
const allowedHue = (hue) => (~~(hue/4))*4;
const randColor = (hue) => `hsl(${allowedHue(hue || ~~rand(0, 360))}, 89%, 50%)`;

let perf = document.getElementById('perf');

let canvas = document.getElementById('world');
let w = canvas.width = window.innerWidth;
let h = canvas.height = window.innerHeight;
let ctx = canvas.getContext('2d');
ctx.fillStyle = 'black';
ctx.fillRect(0, 0, w, h);

let particles = {};
let newParticles = [];

function push(p) {
    newParticles.push(p);
} 
function processPushes() {
    for (let i = 0; i < newParticles.length; i++) {
        let p = newParticles[i];
        if (!particles[p.color]) particles[p.color] = [];
        particles[p.color].push(p);
    }
    newParticles = [];
}

let gravity = variables.range("gravity", 806, 600, 2000);
let startVx = variables.range("startVx", w/8, w/10, w/2);
let timeToParticle = variables.range("ttp (ms)", 800, 500, 2000);
let haloRadius = variables.range("halo radius", 12, 8, 18);
let explosionForce = variables.range("explosion force", 46640400, 30000000, 90000000);

function fader(p) {
    p.behavior = dt => {
        p.vx *= 0.97;
        p.vy *= 0.97;
        if (Math.abs(p.vx)+Math.abs(p.vy) < 20)
            p.dead = true;
    };
    return p; 
}

function exploder(p) {
    p.fuse = rand(0.5, 1.0);
    p.behavior = dt => {
        p.vy += gravity() * dt;

        p.fuse -= dt;
        if (p.fuse <= 0) {
            let subparticles = new Array(~~rand(80, 120));
            for (let i = 0; i < subparticles.length; i++) {
                let t = rand(0, 2*Math.PI);
                let v = Math.cbrt(rand(0, explosionForce()));
                subparticles[i] = fader({
                    ...p,
                    vx: v*Math.cos(t),
                    vy: v*Math.sin(t),
                    behavior: () => {},
                });
            }
            if (p.modExplosion) p.modExplosion(subparticles);
            for (let subp of subparticles)
                push(subp);
            p.dead = true;
        }
    };
    return p;
}

const multicolorExplosion = next => subparticles => {
    let k = ~~((subparticles.length + 2) / 3);
    let baseHue = rand(0, 360);
    for (let i = 0; i < 3; i++) {
        let color = randColor(21*i + baseHue);
        for (let j = 0; j < k && i*k+j < subparticles.length; j++)
            subparticles[i*k+j].color = color;
    }

    if (next) next(subparticles);
}

let ttp = 0;
function update(dt) {
    for (let color in particles) {
        let ps = particles[color];
        for (let p of ps) {
            p.x += p.vx * dt;
            p.y += p.vy * dt;
            p.behavior(dt);
        }
    }

    for (let color in particles) {
        let ps = particles[color];
        for (let i = 0; i < ps.length; i++) {
            if (ps[i].y + haloRadius() > h || ps[i].dead) {
                ps[i] = ps[ps.length-1];
                ps.pop();
                i--;
            }
        }
        if (!particles[color].length)
            delete particles[color];
    }

    ttp -= dt;
    if (ttp <= 0) {
        ttp = rand(0.2, timeToParticle()/1000);
        push(exploder({
            x: rand(0, w),
            y: h-1,
            vx: rand(-startVx(), startVx()),
            vy: rand(-1500, -400),
            color: randColor(),
            intensity: 3,
            modExplosion: multicolorExplosion(),
            behavior: () => {},
        }));
    }

    processPushes();
}

function clear() {
    ctx.globalCompositeOperation = 'darken';
    ctx.fillStyle = 'rgba(0,0,0,.9)';
    ctx.beginPath();
    for (let color in particles) {
        let ps = particles[color];
        for (let p of ps) {
            ctx.moveTo(p.x|0, p.y|0);
            ctx.arc(p.x|0, p.y|0, haloRadius(), 0, 2*Math.PI);
        }
    }
    ctx.fill();
}

let totalParticles = 0; // weird ugly hack
let totalColors = 0;
function draw() {
    totalParticles = 0;
    totalColors = 0;
    ctx.globalCompositeOperation = 'lighten';

    // White core
    ctx.fillStyle = 'white';
    ctx.beginPath();
    for (let color in particles) {
        let ps = particles[color];
        for (let p of ps) {
            ctx.moveTo(p.x|0, p.y|0);
            ctx.arc(p.x|0, p.y|0, 2, 0, 2*Math.PI);
        }
    }
    ctx.fill();

    // Colored halos
    ctx.globalAlpha = 0.15;
    const haloDelta = (haloRadius() - 3) / 3;
    for (let color in particles) {
        let ps = particles[color];
        ctx.fillStyle = color;
        for (let p of ps) {
            ctx.beginPath();
            // for (let r = 3, i = 0; i <= 3; r += haloDelta, i++) {
                ctx.moveTo(p.x|0, p.y|0);
                ctx.arc(p.x|0, p.y|0, 12, 0, 2*Math.PI);
            // }
            ctx.fill();
        }

        totalParticles += ps.length;
        totalColors++;
    }
    ctx.globalAlpha = 1.0;
}

let perfAvg = 0;
let lastFrame = performance.now();
function loop() {
    let thisFrame = performance.now();
    let dt = (thisFrame - lastFrame) / 1000;
    lastFrame = thisFrame;

    if (dt < 1000) {
        clear();
        update(dt);
        draw();

        let perfThisFrame = 1000 / (performance.now() - thisFrame);
        perfAvg = Math.min(1000, 0.95*perfAvg + 0.05*perfThisFrame);
        let text = '1/dt (avg): ' + (perfAvg >= Infinity ? "∞" : Math.round(perfAvg / 10) * 10);
        text += `\n${totalParticles} particles`;
        text += `\n${totalColors} colors`;
        perf.innerText = text;
    }
    requestAnimationFrame(loop);
}
loop();
